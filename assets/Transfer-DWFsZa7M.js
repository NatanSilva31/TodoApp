import{r as m,j as e}from"./vendor-B-2yl_ca.js";import{u as U,b as G}from"./tasks-Bc7UcxXI.js";import{U as Q,h as n,n as X,o as K,a9 as V,K as b,aa as k,I as P,ab as W,ac as Y,ad as Z,ae as ee,af as re,ag as x,s as E,ah as ae,e as w}from"./settings-C_-OD5GG.js";import{a as v}from"./emoji-D7qZVVSC.js";import{f as I,g as oe,aP as se,a7 as te,bq as N,bD as O,B as ne,bE as ie,bg as le}from"./ui-lib-C41lPcrf.js";import"./ntc-LB1IgDFN.js";const je=()=>{const{user:s,setUser:h}=m.useContext(Q),[l,A]=U([],"tasksToExport","sessionStorage"),[F,j]=m.useState(!1),c=m.useRef(null);G(),m.useEffect(()=>{document.title="Todo App - Transferir tarefas"},[]),m.useEffect(()=>{c.current&&(c.current.value="")},[s.createdAt]);const B=r=>{A(a=>a.includes(r)?a.filter(d=>d!==r):[...a,r])},q=()=>{const r=s.tasks.filter(a=>l.includes(a.id));w(r),n(e.jsxs("div",{children:["Tarefas exportadas:"," ",e.jsx("ul",{children:r.map(a=>e.jsx("li",{children:e.jsxs(k,{children:[e.jsx(v,{unified:a.emoji||"",size:20,emojiStyle:s.emojisStyle}),e.jsx("span",{translate:"no",children:a.name})]})},a.id))})]}),{dismissButton:!0,type:"blank"})},D=()=>{if(s.tasks.length===0){n("Nenhuma tarefa para exportar",{type:"error"});return}w(s.tasks),n(`Exportou todas as tarefas (${s.tasks.length})`)},u=m.useCallback(r=>{const a=r;if(a){if(a.type!=="application/json"){n(e.jsxs("div",{children:["Tipo de arquivo incorreto ",a.type!==""&&e.jsx("span",{translate:"no",children:a.type}),". Selecione um arquivo do tipo JSON."]}),{type:"error"});return}const d=new FileReader;d.onload=g=>{var T;try{const i=JSON.parse((T=g.target)==null?void 0:T.result);if(!Array.isArray(i)){n("O arquivo importado tem uma estrutura inválida.",{type:"error"});return}const S=i.filter(o=>o.name&&o.name.length>X||o.description&&o.description.length>K||o.category&&o.category.some(p=>p.name.length>V));if(S.length>0){const o=S.map(t=>t.name).join(", ");console.error(`Essas tarefas não podem ser importadas devido ao excesso de comprimento máximo de caracteres: ${o}`),n(`Essas tarefas não podem ser importadas devido ao excesso de comprimento máximo de caracteres: ${o}`,{type:"error"});return}const L=o=>o.color&&b(o.color);if(i.some(o=>o.color&&!b(o.color)||o.category&&!o.category.every(t=>L(t)))){n("O arquivo importado contém tarefas com formatos de cores inválidos.",{type:"error"});return}const C=6*1024*1024;if(a.size>C){const o=new Intl.NumberFormat("en-US",{style:"unit",unit:"megabyte",maximumFractionDigits:2}),t=a.size/(1024*1024),p=C/(1024*1024);n(`O tamanho do arquivo é muito grande (${o.format(t)}/${o.format(p)})`,{type:"error"});return}const y=s.categories.slice();i.forEach(o=>{o.category&&o.category.forEach(t=>{const p=y.find(f=>f.id===t.id);p?Object.assign(p,t):y.push(t)})}),h(o=>({...o,categories:y}));const R=[...s.tasks,...i].reduce((o,t)=>o.find(f=>f.id===t.id)?o.map(f=>f.id===t.id?t:f):[...o,t],[]);h(o=>({...o,tasks:R}));const H=i.map(o=>o.name).join(", ");console.log(`Tarefas importadas: ${H}`),n(e.jsxs("div",{children:["Tarefas importadas com êxito de ",e.jsx("br",{}),e.jsx("i",{translate:"no",style:{wordBreak:"break-all"},children:a.name}),e.jsx("ul",{children:i.map(o=>e.jsx("li",{children:e.jsxs(k,{children:[e.jsx(v,{unified:o.emoji||"",size:20,emojiStyle:s.emojisStyle}),e.jsx("span",{translate:"no",children:o.name})]})},o.id))})]}),{dismissButton:!0,type:"blank"}),c.current&&(c.current.value="")}catch(i){console.error(`Erro ao analisar o arquivo importado ${a.name}:`,i),n(e.jsxs("div",{style:{wordBreak:"break-all"},children:["Erro ao analisar o arquivo importado: ",e.jsx("br",{})," ",e.jsx("i",{children:a.name})]}),{type:"error"}),c.current&&(c.current.value="")}},d.readAsText(a)}},[s.categories,s.emojisStyle,s.tasks,h]),M=async()=>{try{const r=await navigator.clipboard.readText();r.startsWith(`${location.protocol}//${location.hostname}`)?window.open(r,"_self"):n(e.jsx("div",{children:"Falha ao importar a tarefa do link fornecido. Certifique-se de que o link foi copiado corretamente."}),{type:"error"})}catch(r){console.error("Falha ao ler o conteúdo da área de transferência: ",r)}},z=async()=>{try{const r=await navigator.clipboard.readText(),a=new File([r],"Clipboard",{type:"application/json"});u(a)}catch(r){console.error("Falha ao ler o conteúdo da área de transferência: ",r)}},$=r=>{r.preventDefault(),r.dataTransfer.dropEffect="copy",j(!0)},J=r=>{r.preventDefault(),j(!1);const a=r.dataTransfer.files[0];if(console.log(a),a.size===0||a.type===""){n(e.jsxs("div",{children:["Unknown file type"," ",e.jsx("i",{translate:"no",style:{wordBreak:"break-all"},children:a.name})]}),{type:"error"});return}u(a)},_=r=>{const a=r.target.files&&r.target.files[0];a&&u(a)};return m.useEffect(()=>{window.launchQueue&&"setConsumer"in window.launchQueue&&window.launchQueue.setConsumer(r=>{var a;if((a=r.files)!=null&&a.length)for(const d of r.files)d.getFile().then(g=>{u(g)})})},[u]),e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Transferir Tarefas"}),e.jsxs(W,{children:["Selecione as tarefas a serem exportadas ",e.jsx(I,{title:"As duplicatas serão removidas durante a importação",children:e.jsx(oe,{style:{color:"#ffffff"},children:e.jsx(Y,{})})})]}),e.jsx(Z,{children:s.tasks.length>0?s.tasks.map(r=>e.jsxs(ee,{backgroundClr:r.color,onClick:()=>B(r.id),selected:l.includes(r.id),translate:"no",children:[e.jsx(se,{color:"primary",size:"medium",checked:l.includes(r.id)}),e.jsxs(te,{variant:"body1",component:"span",sx:{display:"flex",alignItems:"center",gap:"6px",wordBreak:"break-word"},children:[e.jsx(v,{size:24,unified:r.emoji||"",emojiStyle:s.emojisStyle})," ",r.name]})]},r.id)):e.jsx("h3",{style:{opacity:.8,fontStyle:"italic"},children:"Você não tem nenhuma tarefa para exportar"})}),e.jsxs(re,{children:[e.jsx(I,{title:l.length>0?`Selected tasks: ${new Intl.ListFormat("en",{style:"long",type:"conjunction"}).format(l.map(r=>{const a=s.tasks.find(d=>d.id===r);return a?a.name:""}))}`:void 0,children:e.jsxs(x,{onClick:q,disabled:l.length===0,children:[e.jsx(N,{}),"   Exportar selecionado para JSON"," ",l.length>0&&`[${l.length}]`]})}),e.jsxs(x,{onClick:D,disabled:s.tasks.length===0,children:[e.jsx(N,{}),"   Exportar todas as tarefas para JSON"]}),e.jsx("h2",{style:{textAlign:"center"},children:"Importar tarefas do JSON"}),E.os!=="Android"&&E.os!=="iOS"&&e.jsx("div",{style:{width:"300px"},children:e.jsxs(ae,{onDragOver:$,onDragLeave:()=>j(!1),onDrop:J,isDragging:F,children:[e.jsx(O,{fontSize:"large",color:"primary"}),e.jsx("div",{children:"Solte o arquivo JSON aqui para importar tarefas "})]})}),e.jsx("input",{accept:".json",id:"import-file",type:"file",ref:c,style:{display:"none"},onChange:_}),e.jsx("label",{htmlFor:"import-file",children:e.jsxs(ne,{component:"span",variant:"outlined",sx:{p:"12px 20px",borderRadius:"14px",width:"300px"},children:[e.jsx(O,{}),"   Selecione o arquivo JSON"]})}),e.jsxs(x,{onClick:z,children:[e.jsx(ie,{}),"   Importar JSON da área de transferência"]}),e.jsxs(x,{onClick:M,children:[e.jsx(le,{}),"   Importar do link"]})]})]})};export{je as default};
