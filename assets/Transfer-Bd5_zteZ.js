import{r as m,j as e}from"./vendor-CAPrwHoW.js";import{u as G,b as P}from"./tasks-u5ZNZD5t.js";import{U as Q,h as i,n as X,o as q,a9 as K,K as v,aa as C,I as Y,ab as V,ac as W,ad as Z,ae as ee,af as se,ag as u,s as E,ah as te,e as I}from"./settings-BshogTHf.js";import{a as k}from"./emoji-DdLBlTIZ.js";import{f as w,g as re,aP as ne,a7 as oe,bq as F,bD as N,B as ie,bE as ae,bg as le}from"./ui-lib-lpr_KMSR.js";import"./ntc-LB1IgDFN.js";const ge=()=>{const{user:n,setUser:x}=m.useContext(Q),[l,A]=G([],"tasksToExport","sessionStorage"),[D,g]=m.useState(!1),d=m.useRef(null);P(),m.useEffect(()=>{document.title="Todo App - Transfer tasks"},[]),m.useEffect(()=>{d.current&&(d.current.value="")},[n.createdAt]);const B=s=>{A(t=>t.includes(s)?t.filter(c=>c!==s):[...t,s])},O=()=>{const s=n.tasks.filter(t=>l.includes(t.id));I(s),i(e.jsxs("div",{children:["Exported tasks:"," ",e.jsx("ul",{children:s.map(t=>e.jsx("li",{children:e.jsxs(C,{children:[e.jsx(k,{unified:t.emoji||"",size:20,emojiStyle:n.emojisStyle}),e.jsx("span",{translate:"no",children:t.name})]})},t.id))})]}),{dismissButton:!0,type:"blank"})},M=()=>{if(n.tasks.length===0){i("No tasks to export",{type:"error"});return}I(n.tasks),i(`Exported all tasks (${n.tasks.length})`)},h=m.useCallback(s=>{const t=s;if(t){if(t.type!=="application/json"){i(e.jsxs("div",{children:["Incorrect file type ",t.type!==""&&e.jsx("span",{translate:"no",children:t.type}),". Please select a JSON file."]}),{type:"error"});return}const c=new FileReader;c.onload=j=>{var T;try{const a=JSON.parse((T=j.target)==null?void 0:T.result);if(!Array.isArray(a)){i("Imported file has an invalid structure.",{type:"error"});return}const b=a.filter(r=>r.name&&r.name.length>X||r.description&&r.description.length>q||r.category&&r.category.some(p=>p.name.length>K));if(b.length>0){const r=b.map(o=>o.name).join(", ");console.error(`These tasks cannot be imported due to exceeding maximum character lengths: ${r}`),i(`These tasks cannot be imported due to exceeding maximum character lengths: ${r}`,{type:"error"});return}const R=r=>r.color&&v(r.color);if(a.some(r=>r.color&&!v(r.color)||r.category&&!r.category.every(o=>R(o)))){i("Imported file contains tasks with invalid color formats.",{type:"error"});return}const S=6*1024*1024;if(t.size>S){const r=new Intl.NumberFormat("en-US",{style:"unit",unit:"megabyte",maximumFractionDigits:2}),o=t.size/(1024*1024),p=S/(1024*1024);i(`File size is too large (${r.format(o)}/${r.format(p)})`,{type:"error"});return}const y=n.categories.slice();a.forEach(r=>{r.category&&r.category.forEach(o=>{const p=y.find(f=>f.id===o.id);p?Object.assign(p,o):y.push(o)})}),x(r=>({...r,categories:y}));const H=[...n.tasks,...a].reduce((r,o)=>r.find(f=>f.id===o.id)?r.map(f=>f.id===o.id?o:f):[...r,o],[]);x(r=>({...r,tasks:H}));const U=a.map(r=>r.name).join(", ");console.log(`Imported Tasks: ${U}`),i(e.jsxs("div",{children:["Tasks Successfully Imported from ",e.jsx("br",{}),e.jsx("i",{translate:"no",style:{wordBreak:"break-all"},children:t.name}),e.jsx("ul",{children:a.map(r=>e.jsx("li",{children:e.jsxs(C,{children:[e.jsx(k,{unified:r.emoji||"",size:20,emojiStyle:n.emojisStyle}),e.jsx("span",{translate:"no",children:r.name})]})},r.id))})]}),{dismissButton:!0,type:"blank"}),d.current&&(d.current.value="")}catch(a){console.error(`Error parsing the imported file ${t.name}:`,a),i(e.jsxs("div",{style:{wordBreak:"break-all"},children:["Error parsing the imported file: ",e.jsx("br",{})," ",e.jsx("i",{children:t.name})]}),{type:"error"}),d.current&&(d.current.value="")}},c.readAsText(t)}},[n.categories,n.emojisStyle,n.tasks,x]),z=async()=>{try{const s=await navigator.clipboard.readText();s.startsWith(`${location.protocol}//${location.hostname}`)?window.open(s,"_self"):i(e.jsx("div",{children:"Failed to import task from the provided link. Please ensure that the link is copied correctly."}),{type:"error"})}catch(s){console.error("Failed to read clipboard contents: ",s)}},$=async()=>{try{const s=await navigator.clipboard.readText(),t=new File([s],"Clipboard",{type:"application/json"});h(t)}catch(s){console.error("Failed to read clipboard contents: ",s)}},J=s=>{s.preventDefault(),s.dataTransfer.dropEffect="copy",g(!0)},L=s=>{s.preventDefault(),g(!1);const t=s.dataTransfer.files[0];if(console.log(t),t.size===0||t.type===""){i(e.jsxs("div",{children:["Unknown file type"," ",e.jsx("i",{translate:"no",style:{wordBreak:"break-all"},children:t.name})]}),{type:"error"});return}h(t)},_=s=>{const t=s.target.files&&s.target.files[0];t&&h(t)};return m.useEffect(()=>{window.launchQueue&&"setConsumer"in window.launchQueue&&window.launchQueue.setConsumer(s=>{var t;if((t=s.files)!=null&&t.length)for(const c of s.files)c.getFile().then(j=>{h(j)})})},[h]),e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Transfer Tasks"}),e.jsxs(V,{children:["Select Tasks To Export ",e.jsx(w,{title:"Duplicates will be removed during import",children:e.jsx(re,{style:{color:"#ffffff"},children:e.jsx(W,{})})})]}),e.jsx(Z,{children:n.tasks.length>0?n.tasks.map(s=>e.jsxs(ee,{backgroundClr:s.color,onClick:()=>B(s.id),selected:l.includes(s.id),translate:"no",children:[e.jsx(ne,{color:"primary",size:"medium",checked:l.includes(s.id)}),e.jsxs(oe,{variant:"body1",component:"span",sx:{display:"flex",alignItems:"center",gap:"6px",wordBreak:"break-word"},children:[e.jsx(k,{size:24,unified:s.emoji||"",emojiStyle:n.emojisStyle})," ",s.name]})]},s.id)):e.jsx("h3",{style:{opacity:.8,fontStyle:"italic"},children:"You don't have any tasks to export"})}),e.jsxs(se,{children:[e.jsx(w,{title:l.length>0?`Selected tasks: ${new Intl.ListFormat("en",{style:"long",type:"conjunction"}).format(l.map(s=>{const t=n.tasks.find(c=>c.id===s);return t?t.name:""}))}`:void 0,children:e.jsxs(u,{onClick:O,disabled:l.length===0,children:[e.jsx(F,{}),"   Export Selected to JSON"," ",l.length>0&&`[${l.length}]`]})}),e.jsxs(u,{onClick:M,disabled:n.tasks.length===0,children:[e.jsx(F,{}),"   Export All Tasks to JSON"]}),e.jsx("h2",{style:{textAlign:"center"},children:"Import Tasks From JSON"}),E.os!=="Android"&&E.os!=="iOS"&&e.jsx("div",{style:{width:"300px"},children:e.jsxs(te,{onDragOver:J,onDragLeave:()=>g(!1),onDrop:L,isDragging:D,children:[e.jsx(N,{fontSize:"large",color:"primary"}),e.jsx("div",{children:"Drop JSON file here to import tasks "})]})}),e.jsx("input",{accept:".json",id:"import-file",type:"file",ref:d,style:{display:"none"},onChange:_}),e.jsx("label",{htmlFor:"import-file",children:e.jsxs(ie,{component:"span",variant:"outlined",sx:{p:"12px 20px",borderRadius:"14px",width:"300px"},children:[e.jsx(N,{}),"   Select JSON File"]})}),e.jsxs(u,{onClick:$,children:[e.jsx(ae,{}),"   Import JSON from clipboard"]}),e.jsxs(u,{onClick:z,children:[e.jsx(le,{}),"   Import From Link"]})]})]})};export{ge as default};
