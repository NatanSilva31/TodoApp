import{r as o,u as w,b as v,d as I,j as e}from"./vendor-B-2yl_ca.js";import{U as L,K as P,b as h,v as j,D as p,j as g,M as k,h as B}from"./settings-B7nXNRV0.js";import{T as _}from"./tasks-Dg1Jr4qq.js";import G from"./Home-INFBlm0d.js";import{x as H,bv as x,z as E,a3 as b,ag as T,E as y,bw as M,bx as O}from"./ui-lib-C41lPcrf.js";import"./emoji-D7qZVVSC.js";import"./ntc-LB1IgDFN.js";import"./index-BAchXecl.js";const Q=()=>{const{user:D,setUser:R}=o.useContext(L),n=w(),U=v(),f=new URLSearchParams(U.search),d=f.get("task"),l=f.get("userName"),[s,C]=o.useState(null),[m,A]=o.useState(""),[F,i]=o.useState(!1),[N,c]=o.useState();o.useEffect(()=>{const t=a=>{const r={...JSON.parse(a),id:g()};if(!k(r.color)||r.category&&r.category.some(u=>!k(u.color))){i(!0),c("Formato de cor de tarefa ou categoria inválido.");return}C(r)};if(d)try{let a=decodeURIComponent(d);if(a.startsWith("{")||a.startsWith("["))t(a);else{if(a=I.decompressFromEncodedURIComponent(a),!a)throw new Error("Falha na descompactação.");t(a)}}catch(a){console.error("Erro ao decodificar os dados da tarefa:",a),i(!0),c("Falha ao decodificar os dados da tarefa. O link pode estar corrompido. "+a)}else i(!0),c("Nenhum dado de tarefa encontrado no link.");if(l){const a=decodeURIComponent(l);a.length>P&&(i(!0),c("O nome de usuário é muito longo.")),A(a)}},[d,l]),o.useEffect(()=>{document.title=`Todo App - Tarefa Recebida ${s?"("+s.name+")":""}`},[s]);const S=()=>{if(s){const t=[...D.categories];s.category&&s.category.forEach(a=>{const r=t.findIndex(u=>u.id===a.id);r!==-1?t[r]=a:t.push(a)}),R(a=>({...a,categories:t,tasks:[...a.tasks.filter(Boolean),{...s,id:g(),sharedBy:m}]})),n("/"),B(e.jsxs("div",{children:["Tarefa compartilhada adicionada - ",e.jsx("b",{translate:"no",children:s.name})]}),{icon:e.jsx(x,{})})}};return e.jsxs(e.Fragment,{children:[e.jsx(G,{}),e.jsx(H,{open:!0,fullWidth:!0,slotProps:{paper:{style:{borderRadius:"24px",padding:" 10px 6px",width:"100% !important"}}},children:!F&&s?e.jsxs(e.Fragment,{children:[e.jsx(h,{title:"Tarefa recebida",subTitle:"Agora você pode incluí-la em sua lista.",icon:e.jsx(x,{})}),e.jsxs(E,{children:[e.jsxs("p",{style:{fontSize:"16px",marginLeft:"6px"},children:[e.jsx("b",{translate:m==="User"?"yes":"no",children:m})," compartilhou uma tarefa para você."]}),e.jsx(_,{task:s,features:{enableLinks:!1,enableGlow:!1}}),s&&s.description&&s.description.match(j)&&e.jsxs(b,{sx:{mt:"20px"},severity:"warning",children:[e.jsx(T,{children:"Esta tarefa contém os seguintes links:"})," ",(()=>{var a;const t=(a=s.description.match(j))==null?void 0:a.map(r=>r);if(t){const r=new Intl.ListFormat("en-US",{style:"long",type:"conjunction"});return e.jsx("span",{style:{wordBreak:"break-all"},children:r.format(t)})}return null})()]})]}),e.jsxs(y,{children:[e.jsxs(p,{color:"error",onClick:()=>n("/"),children:[e.jsx(M,{}),"   Recusar"]}),e.jsxs(p,{onClick:()=>{S(),n("/")},children:[e.jsx(x,{}),"   Adicionar tarefa"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{title:"Falha ao receber a tarefa",subTitle:"Esta tarefa não pode ser processada.",onClose:()=>n("/"),icon:e.jsx(O,{})}),e.jsx(E,{children:e.jsxs(b,{severity:"error",children:[e.jsx(T,{children:"Erro: falha ao processar a tarefa"}),N]})}),e.jsx(y,{children:e.jsx(p,{onClick:()=>n("/"),children:"Fechar"})})]})})]})};export{Q as default};
