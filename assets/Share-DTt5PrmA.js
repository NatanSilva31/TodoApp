import{r as a,u as v,b as I,d as F,j as e}from"./vendor-CAPrwHoW.js";import{U as L,J as P,b as f,v as k,D as x,j,K as g,h as B}from"./settings-BshogTHf.js";import{T as _}from"./tasks-u5ZNZD5t.js";import G from"./Home-C2QVfhSV.js";import{x as H,bv as h,z as T,a3 as y,ag as E,E as b,bw as W,bx as z}from"./ui-lib-lpr_KMSR.js";import"./emoji-DdLBlTIZ.js";import"./ntc-LB1IgDFN.js";import"./index-BfwLUpml.js";const $=()=>{const{user:D,setUser:U}=a.useContext(L),n=v(),R=I(),p=new URLSearchParams(R.search),c=p.get("task"),d=p.get("userName"),[t,C]=a.useState(null),[m,w]=a.useState(""),[A,i]=a.useState(!1),[N,l]=a.useState();a.useEffect(()=>{const o=s=>{const r={...JSON.parse(s),id:j()};if(!g(r.color)||r.category&&r.category.some(u=>!g(u.color))){i(!0),l("Invalid task or category color format.");return}C(r)};if(c)try{let s=decodeURIComponent(c);if(s.startsWith("{")||s.startsWith("["))o(s);else{if(s=F.decompressFromEncodedURIComponent(s),!s)throw new Error("Decompression failed.");o(s)}}catch(s){console.error("Error decoding task data:",s),i(!0),l("Failed to decode task data. The link may be corrupted. "+s)}else i(!0),l("No task data found in the link.");if(d){const s=decodeURIComponent(d);s.length>P&&(i(!0),l("User name is too long.")),w(s)}},[c,d]),a.useEffect(()=>{document.title=`Todo App - Recieved Task ${t?"("+t.name+")":""}`},[t]);const S=()=>{if(t){const o=[...D.categories];t.category&&t.category.forEach(s=>{const r=o.findIndex(u=>u.id===s.id);r!==-1?o[r]=s:o.push(s)}),U(s=>({...s,categories:o,tasks:[...s.tasks.filter(Boolean),{...t,id:j(),sharedBy:m}]})),n("/"),B(e.jsxs("div",{children:["Added shared task - ",e.jsx("b",{translate:"no",children:t.name})]}),{icon:e.jsx(h,{})})}};return e.jsxs(e.Fragment,{children:[e.jsx(G,{}),e.jsx(H,{open:!0,fullWidth:!0,slotProps:{paper:{style:{borderRadius:"24px",padding:" 10px 6px",width:"100% !important"}}},children:!A&&t?e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Recieved Task",subTitle:"You can now include it in your list.",icon:e.jsx(h,{})}),e.jsxs(T,{children:[e.jsxs("p",{style:{fontSize:"16px",marginLeft:"6px"},children:[e.jsx("b",{translate:m==="User"?"yes":"no",children:m})," shared you a task."]}),e.jsx(_,{task:t,features:{enableLinks:!1,enableGlow:!1}}),t&&t.description&&t.description.match(k)&&e.jsxs(y,{sx:{mt:"20px"},severity:"warning",children:[e.jsx(E,{children:"This task contains the following links:"})," ",(()=>{var s;const o=(s=t.description.match(k))==null?void 0:s.map(r=>r);if(o){const r=new Intl.ListFormat("en-US",{style:"long",type:"conjunction"});return e.jsx("span",{style:{wordBreak:"break-all"},children:r.format(o)})}return null})()]})]}),e.jsxs(b,{children:[e.jsxs(x,{color:"error",onClick:()=>n("/"),children:[e.jsx(W,{}),"   Decline"]}),e.jsxs(x,{onClick:()=>{S(),n("/")},children:[e.jsx(h,{}),"   Add Task"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Failed to recieve Task",subTitle:"This Task could not be processed.",onClose:()=>n("/"),icon:e.jsx(z,{})}),e.jsx(T,{children:e.jsxs(y,{severity:"error",children:[e.jsx(E,{children:"Error: failed to process the task"}),N]})}),e.jsx(b,{children:e.jsx(x,{onClick:()=>n("/"),children:"Close"})})]})})]})};export{$ as default};
